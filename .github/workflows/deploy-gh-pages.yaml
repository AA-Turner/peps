name: Deploy to GitHub Pages
on: [push]
jobs:
  deploy-to-pages:
    runs-on: ubuntu-latest
    steps:
      # If you're using actions/checkout@v2 you must set persist-credentials to false in most cases for the deployment to work correctly.
      - name: Checkout 🛎️
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Set up Python (3.7) 🐍
        uses: actions/setup-python@v2
        with:
          python-version: 3.7

      - name: Cache pip 🧳
        uses: actions/cache@v2
        with:
          # This path is specific to Ubuntu
          path: ~/.cache/pip
          # Look to see if there is a cache hit for the corresponding requirements file
          key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-
            ${{ runner.os }}-

      # This example project is built using npm and outputs the result to the 'build' folder.
      # Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
      - name: Install and Build 🔧
        run: |
          set -x
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          make sphinx

      - name: Deploy 🚀
        uses: JamesIves/github-pages-deploy-action@releases/v3
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          BRANCH: gh-pages # The branch the action should deploy to.
          FOLDER: build # The folder the action should deploy.

# TODO enable build only on master
#on:
#  push:
#    branches:
#      - master